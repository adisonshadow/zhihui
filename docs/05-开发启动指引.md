# 芝绘 - 开发启动指引（供 AI 直接按此开始开发）

本文档供 Cursor 或开发者**直接据此开始编码**，无需再反复查阅多份文档。按顺序执行即可。

---

## 1. 权威文档与顺序

- **需求与界面**：`docs/01-功能文档.md`（含 1.1 术语表：工作区、画布/视口、播放器面板、时间线、素材条、占位指示条、选中时间轴、素材面板、功能面板、本地素材、预设素材、元件组；用户习惯持久化 localStorage）
- **技术约束**：`docs/02-技术文档.md`（Vite、Yarn、Ant Design dark、Ant Design X 三件套、参考项目、画布/透明视频/坐标单位、SQLite、添加包规则）
- **任务列表**：`docs/03-开发计划和进度.md`（按模块 Todo 执行，做完勾选）
- **AI 协作约定**：`docs/04-AI开发文档.md`（禁止直接改 package.json、必须 Yarn+代理、测试用 `yarn test`）

---

## 2. 添加依赖（必须遵守）

**禁止直接修改 `package.json` 添加包。**

每次添加依赖前在终端执行：

```bash
export http_proxy=http://127.0.0.1:7897
export https_proxy=http://127.0.0.1:7897
yarn add <包名>
```

多包示例：`yarn add @ant-design/x @ant-design/x-markdown @ant-design/x-sdk`。此规则已写入 `.cursor/rules`，Cursor 会牢记。

---

## 3. 技术栈速查

| 项         | 选型 |
| ---------- | ---- |
| 构建       | Vite |
| 包管理     | Yarn |
| UI         | Ant Design，仅 dark 主题 |
| 布局可 Resize | Ant Design Splitter |
| AI Chat    | Ant Design X（@ant-design/x、@ant-design/x-markdown、@ant-design/x-sdk） |
| 路由参考   | React Router v6（见 Biezhi2/web） |
| 主题参考   | ConfigProvider + theme.darkAlgorithm + zh_CN（见 Biezhi2/web/main.tsx） |
| Tailwind   | v4 + @tailwindcss/postcss（见 Biezhi2/web） |
| 数据库     | SQLite（应用级 + 项目级） |

参考项目路径：`/Users/yanfang/dev/Biezhi2/web`（路由、Ant Design 主题、Tailwind、目录结构可参考，不拷贝）。

---

## 4. 开发顺序建议（对应 03 开发计划）

1. **2.1 工程与基础**：Electron + React + Vite 脚手架 → Ant Design dark 主题 → Tailwind v4 → 应用级 SQLite 与 IPC → 预加载与 contextBridge。
2. **2.2 漫剧项目列表**：列表页、新建/打开/删除、与应用级 SQLite 联动。
3. **2.4 项目级数据与目录**：项目目录结构、项目级 SQLite 表设计与 API，供后续模块使用。
4. **2.3 设置面板**：多模态 AI 供应商配置与持久化。
5. **2.5 剧情大纲**：集管理、概要/剧本编辑、Ant Design X 剧本专家 Chat、人物绑定。
6. **2.6 人物设计**：人物 CRUD、形象来源、AI 绘画、TTS 默认参数。
7. **2.7 AI 配置（项目级）**：剧本专家/绘画自定义要求。
8. **2.8 素材体系**：分类、素材包 YAML、素材库 UI、上传与常用。
9. **2.9–2.12 漫剧视频设计器**：布局与 Splitter → 画布与容器 → 分层与时间轴 → 素材浏览与选中设置。
10. **2.14 AI Chat 集成**：视频设计器列 4 的 Ant Design X Chat。
11. **2.13 视频导出**：帧序列 + 音频、ffmpeg、进度与结果。
12. **2.15 测试与质量**：数据层/业务规则/导出测试，`yarn test` 配置。

---

## 5. 单次任务时 AI 应做的

- 接任务时先确认对应「功能文档 x.x / 技术文档 x.x / 开发计划 2.x」。
- 需要加包时：回复将执行「代理 + yarn add」，并给出具体命令，**不**贴 package.json 的 diff。
- 实现后若该模块有 Todo，在 `docs/03-开发计划和进度.md` 中勾选对应项。
- 关键逻辑注释注明文档出处（如：`// 见功能文档 6.3`）。
- 测试命令：`yarn test`。

---

## 6. 画布与导出约定（已确认）

- **透明视频**：可采用 DOM + `<video>` 合成方案（技术文档 4.1）。
- **坐标与尺寸**：位置/缩放/旋转用与画布成比例表述（归一化或百分比存储），渲染时换算为 px（技术文档 4.2）。

按以上顺序与约束，即可从「2.1 工程与基础」开始实现；遇到歧义以 01/02 文档为准。
